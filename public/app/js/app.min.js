var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,c){a!=Array.prototype&&a!=Object.prototype&&(a[d]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,c,b){if(d){c=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var h=a[b];h in c||(c[h]={});c=c[h]}a=a[a.length-1];b=c[a];d=d(b);d!=b&&null!=d&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var d=b.length;for(c=c||0;c<d;c++)if(b[c]==a||Object.is(b[c],a))return!0;return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,d,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(d instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(d){return $jscomp.SYMBOL_PREFIX+(d||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var d=0;return $jscomp.iteratorPrototype(function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,b={next:function(){if(c<a.length){var h=c++;return{value:d(h,a[h]),done:!1}}b.next=function(){return{done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
angular.module("portailApp","ngResource ui.router ui.bootstrap as.sortable ui.checkbox ngTouch angularMoment ngColorPicker angular-carousel ngFitText zxcvbn toastr".split(" ")).config(["$stateProvider","$urlRouterProvider","$locationProvider","APP_PATH",function(a,d,c,b){a.state("portail",{url:"/",component:"portail"}).state("app",{url:"/app/:appid",component:"appWrapper",resolve:{appId:["$transition$",function(a){return a.params().appid}]}});d.otherwise("/")}]).config(["$httpProvider",function(a){a.defaults.useXDomain=
!0;a.defaults.withCredentials=!0;a.interceptors.push(["$q","$window",function(a,c){return{responseError:function(a){401===a.status&&(c.location.href="/sso/login?ticket\x3dfalse\x26service\x3d"+encodeURIComponent(c.location.href));return a}}}])}]).run(["$rootScope","log",function(a,d){a.modification=!1;a.$on("$stateChangeSuccess",function(a,b,h,e,k){d.add("app"==b.name?h.appid:"PORTAIL",null,null)})}]);
angular.module("portailApp").constant("CASES",[{color:"bleu"},{color:"jaune"},{color:"violet"},{color:"vert"},{color:"rouge"},{color:"vert"},{color:"bleu"},{color:"jaune"},{color:"violet"},{color:"bleu"},{color:"jaune"},{color:"rouge"},{color:"jaune"},{color:"rouge"},{color:"vert"},{color:"violet"}]).constant("COULEURS",["#1aa1cc","#80ba66","#eb5454","#9c75ab","#e8c254"]).factory("RANDOM_IMAGES",["APP_PATH",function(a){return[a+"/app/node_modules/laclasse-common-client/images/logolaclasse.svg",a+
"/app/node_modules/laclasse-common-client/images/random/20150116_102448.jpg",a+"/app/node_modules/laclasse-common-client/images/random/20150204_152946.jpg"]}]);
angular.module("portailApp").component("appWrapper",{bindings:{appId:"\x3c"},controller:["$stateParams","$sce","currentUser","Annuaire","Tiles","Utils",function(a,d,c,b,h,e){var k=this;k.$onInit=function(){c.get(!0).then(function(a){k.user=a;(_(k.user.profiles).isEmpty()?b.query_applications():h.query({structure_id:k.user.active_profile().structure_id}).$promise).then(function(a){k.app=_(a).findWhere({application_id:k.appId});_(k.app).isUndefined()&&e.go_home();k.app.url=d.trustAsResourceUrl(k.app.url)})})}}],
template:'\n\x3cdiv id\x3d"app-wrapper"\x3e\n    \x3cdiv class\x3d"en-tete container gris4" role\x3d"navigation"\x3e\n        \x3clogo class\x3d"petit logolaclasse gris4 pull-left"\n              user\x3d"$ctrl.user"\x3e\x3c/logo\x3e\n\n        \x3cspan class\x3d"hidden-xs hidden-sm titre" ng:cloak\x3e{{$ctrl.app.name}}\x3c/span\x3e\n\n        \x3cprofilactif class\x3d"gris4 profil-select-wrapper"\n                     ng:if\x3d"$ctrl.user.profiles"\n                     user\x3d"$ctrl.user"\x3e\x3c/profilactif\x3e\n    \x3c/div\x3e\n\n    \x3cappiframe url\x3d"$ctrl.app.url"\n               class\x3d"appiframe"\x3e\x3c/appiframe\x3e\n\x3c/div\x3e\n'});
angular.module("portailApp").component("appiframe",{bindings:{url:"\x3c"},controller:[function(){var a=this;a.$onInit=function(){a.iOS=null!==navigator.userAgent.match(/iPad/i)||null!==navigator.userAgent.match(/iPhone/i)}}],template:'\n\x3cdiv class\x3d"iframe" ng:class\x3d"{\'ios\': $ctrl.iOS}"\x3e\n    \x3ciframe id\x3d"iframe" frameBorder\x3d"0"\n            scrolling\x3d"{{$ctrl.iOS ? \'no\': \'yes\'}}"\n            ng:src\x3d"{{$ctrl.url}}"\x3e\n    \x3c/iframe\x3e\n\x3c/div\x3e\n'});
angular.module("portailApp").directive("fileChanged",function(){return{restrict:"A",link:function(a,d,c){d.bind("change",a.$eval(c.fileChanged))}}}).component("avatar",{controller:["currentUser","URL_ENT","User",function(a,d,c){var b=this;b.URL_ENT=d;b.processing=!1;var h=function(a,b){var c=new FileReader;c.onload=function(a){b(a.target.result)};c.readAsDataURL(a)},e=function(a){b.processing=!0;h(a,function(a){var c=new Image;b.user.new_avatar.image=a;c.onload=function(){b.user.new_avatar.height=
c.height;b.user.new_avatar.width=c.width;if(256<b.user.new_avatar.width){var a=256/c.width;b.user.new_avatar.width=256;b.user.new_avatar.height=c.height*a}256<b.user.new_avatar.height&&(a=256/c.height,b.user.new_avatar.height=256,b.user.new_avatar.width=c.width*a);a=document.createElement("canvas");a.width=b.user.new_avatar.width;a.height=b.user.new_avatar.height;a.getContext("2d").drawImage(c,0,0,b.user.new_avatar.width,b.user.new_avatar.height);b.user.new_avatar.image=a.toDataURL();a=b.user.new_avatar;
var e=b.user.new_avatar.image;var d=0<=e.split(",")[0].indexOf("base64")?atob(e.split(",")[1]):unescape(e.split(",")[1]);e=e.split(",")[0].split(":")[1].split(";")[0];for(var h=new Uint8Array(d.length),k=0;k<d.length;k++)h[k]=d.charCodeAt(k);d=new Blob([h],{type:e});a.blob=d};c.src=b.user.new_avatar.image;b.processing=!1})};b.onChange=function(a){e(a.target.files[0])};var k=function(){b.user.new_avatar={image:null,blob:null,width:0,height:0}};b.upload_avatar=function(){b.user.$upload_avatar().then(function(a){k()})};
b.delete=function(){b.user.avatar="empty";b.user.$update()};b.$onInit=function(){a.get(!1).then(function(a){b.user=a;k()})}}],template:'\n\x3cdiv class\x3d"avatar"\x3e\n    \x3cimg draggable\x3d"false" class\x3d"svg"\n         ng:src\x3d"{{$ctrl.user.new_avatar.image ? $ctrl.user.new_avatar.image : $ctrl.URL_ENT + \'/\' + $ctrl.user.avatar}}" /\x3e\n    \x3cbutton style\x3d"position: absolute; top: 0; right: 0;"\n            title\x3d"Supprimer l\'avatar existant"\n            ng:if\x3d"!$ctrl.user.new_avatar.blob"\n            ng:click\x3d"$ctrl.delete()"\x3e\n        \x3cspan class\x3d"glyphicon glyphicon-remove"\n              style\x3d"color: red;" \x3e\x3c/span\x3e\n    \x3c/button\x3e\n\n    \x3cinput type\x3d"file" file-changed\x3d"$ctrl.onChange" ng:if\x3d"!$ctrl.processing"/\x3e\n    \x3cspan ng:if\x3d"$ctrl.processing"\x3e\x3ci class\x3d"fa fa-spinner fa-pulse"\x3e\x3c/i\x3e traitement\x3c/span\x3e\n    \x3cfooter\x3e\n        \x3cbutton ng:disabled\x3d"!$ctrl.user.new_avatar.blob"\n                ng:click\x3d"$ctrl.upload_avatar()"\x3eValider l\'avatar\x3c/button\x3e\n    \x3c/footer\x3e\n\x3c/div\x3e\n'});
angular.module("portailApp").component("helpIcon",{bindings:{user:"\x3c"},controller:["CONFIG",function(a){var d=this;d.$onInit=function(){d.help_links=_(a.help_links).select(function(a){return!_(d.user.profiles).isEmpty()&&0<_(a.profils).intersection(_(d.user.profiles).pluck("type")).length})}}],template:'\n\x3cdiv uib-dropdown\n     keyboard-nav\n     ng:if\x3d"$ctrl.help_links.length \x3e 0"\x3e\n    \x3ca class\x3d"uib-dropdown-toggle" uib-dropdown-toggle\x3e\x3ch2\x3e?\x3c/h2\x3e \x3c/a\x3e\n    \x3cul class\x3d"dropdown-menu" uib-dropdown-menu role\x3d"menu" aria-labelledby\x3d"simple-btn-keyboard-nav"\x3e\n        \x3cli ng:repeat\x3d"link in $ctrl.help_links"\x3e\n            \x3ca ng:href\x3d"{{link.url}}" target\x3d"_blank"\x3e{{link.title}}\x3c/a\x3e\n        \x3c/li\x3e\n    \x3c/ul\x3e\n\x3c/div\x3e\n'});
angular.module("portailApp").component("logo",{bindings:{user:"\x3d"},controller:["Utils","APP_PATH",function(a,d){var c=this;c.prefix=d;c.go_home=function(){c.user.edit_profile=!1;a.go_home()}}],template:'\n\x3ca ng:click\x3d"$ctrl.go_home()"\x3e\n  \x3cimg draggable\x3d"false" ng:src\x3d"{{$ctrl.prefix}}/app/node_modules/laclasse-common-client/images/logolaclasse.svg" /\x3e\n\x3ch3 class\x3d"hidden-xs hidden-sm ent-name" style\x3d"background-image: url(\'/portail/app/node_modules/laclasse-common-client/images/grandlyon-logo-blanc.svg\');background-size: contain;background-repeat: no-repeat;background-position-x: right;background-position-y: center; background-color: #da0000; background-blend-mode: overlay; width: 300px;height: 42px; text-align: left;margin-right: 0px;"\x3elaclasse.com\x3c/h3\x3e\n\x3c/a\x3e\n'});
angular.module("portailApp").component("news",{bindings:{edition:"\x3c"},controller:["$sce","Popups","$http","$q","URL_ENT","RANDOM_IMAGES","currentUser",function(a,d,c,b,h,e,k){var g=this;g.newsfeed=[];g.retrieve_news=function(d){var k=moment().subtract(1,"months").toDate().toISOString();c.get(h+"/api/news",{params:{user_id:g.user.id,"pubDate\x3e":k}}).then(function(e){g.newsfeed=_(e.data).map(function(b,c){b.trusted_content=a.trustAsHtml(b.description);b.no_image=_(b.image).isNull();b.pubDate=moment(new Date(b.pubDate)).toDate();
b.image="app/node_modules/laclasse-common-client/images/11_publipostage.svg";return b});g.carouselIndex=0;return _(g.user.profiles).isEmpty()?b.resolve({data:[]}):c.get(h+"/api/structures/"+g.user.active_profile().structure_id+"/rss",{params:{"pubDate\x3e":k}})}).then(function(b){g.newsfeed=g.newsfeed.concat(_(b.data).map(function(b,c){b.trusted_content=a.trustAsHtml(b.content);b.no_image=_(b.image).isNull();b.pubDate=moment(new Date(b.pubDate)).toDate();_(b.image).isNull()&&(b.image=_(e).sample());
return b}))})};g.config_news_fluxes=function(){d.manage_fluxes(function(){g.retrieve_news(!0)},function(){})};g.$onInit=function(){k.get(!1).then(function(a){g.user=a;g.retrieve_news(!1)})}}],template:'\n\x3cul class\x3d"noir" rn-carousel rn-carousel-buffered rn-carousel-auto-slide\x3d"6" rn-carousel-index\x3d"$ctrl.carouselIndex"\x3e\n    \x3cli ng:repeat\x3d"slide in $ctrl.newsfeed | orderBy:\'pubDate\':true" active\x3d"slide.active"\n        ng:class\x3d"{\'publipostage\': slide.title \x3d\x3d \'Publipostage\', \'no-image\': slide.no_image}"\x3e\n        \x3cdiv class\x3d"carousel-image"\n             ng:style\x3d"{\'background-image\': \'url(\' + slide.image + \')\'}"\x3e\x3c/div\x3e\n        \x3cdiv class\x3d"carousel-caption"\x3e\n            \x3cspan class\x3d"pub-date" ng:cloak\x3e{{ slide.pubDate | date:\'medium\' }}\x3c/span\x3e\n            \x3ca href\x3d"{{ slide.link }}" target\x3d"_blank" ng:if\x3d"slide.link !\x3d \'notYetImplemented\'"\x3e\n                \x3ch6 ng:cloak\x3e{{ slide.title }}\x3c/h6\x3e\n            \x3c/a\x3e\n            \x3ch6 ng:if\x3d"slide.link \x3d\x3d \'notYetImplemented\'"\x3e{{ slide.title }}\x3c/h6\x3e\n            \x3cp ng:bind-html\x3d"slide.trusted_content"\x3e\x3c/p\x3e\n        \x3c/div\x3e\n    \x3c/li\x3e\n    \x3cdiv class\x3d"hidden-xs hidden-sm angular-carousel-indicators"\n         rn-carousel-indicators\n         slides\x3d"$ctrl.newsfeed"\n         rn-carousel-index\x3d"$ctrl.carouselIndex"\x3e\n    \x3c/div\x3e\n    \x3cspan class\x3d"hidden-xs hidden-sm floating-button big toggle bouton-config-news blanc"\n          ng:if\x3d"$ctrl.user.is_admin() \x26\x26 $ctrl.edition"\n          ng:click\x3d"$ctrl.config_news_fluxes()"\x3e\x3c/span\x3e\n\x3c/ul\x3e\n'});
angular.module("portailApp").component("portail",{controller:["$sce","$state","$uibModal","$q","CASES","COULEURS","currentUser","Utils","CCN","Tiles","APP_PATH","CACHE_BUSTER","User","Annuaire","URL_ENT","Popups",function(a,d,c,b,h,e,k,g,m,n,q,l,t,u,v,w){var f=this;f.$onInit=function(){k.get(!0).then(function(a){f.user=a;f.prefix=q;f.COULEURS=e;f.CACHE_BUSTER=l;f.get_tile_template=function(a){return{app:"app/views/tile_app.html?v\x3d"+l,back:"app/views/tile_app.html?v\x3d"+l,regroupement:"app/views/tile_regroupement.html?v\x3d"+
l,eleve:"app/views/tile_eleve.html?v\x3d"+l,rn:"app/views/tile_rn.html?v\x3d"+l,ccn:"app/views/tile_ccn.html?v\x3d"+l}[a]};f.filter_criteria={};var c={index:0,taxonomy:"back",name:"\u2190 Retour",description:"Retour",color:"gris3",action:function(){f.tree=f.tiles;f.parent=null}},t=function(){return b.all(_.chain(f.tree.tiles).select(function(a){return _(a).has("configure")&&a.configure}).map(function(a){return n.update(a).$promise}))},x=function(a){var b=function(a){var b=angular.copy(c);b.action=
a.action;return b},e=function(){return function(a){return!0}},p={MAIL:{modify:function(a){k.recent_mail().then(function(b){a.notifications=b.data});return a}},CCNUM:{action:function(){f.modification||(f.tree={configurable:!1,filter:e,aside_template:"app/views/aside_CCNUM.html?v\x3d"+l,tiles:g.pad_tiles_tree([c].concat(m.query().map(function(c,d){c.taxonomy="ccn";c.index=d+1;_(c).has("leaves")&&(c.action=function(){f.tree={configurable:!1,filter:e,aside_template:"app/views/aside_CCNUM_archives.html?v\x3d"+
l,tiles:[b(a)].concat(c.leaves.map(function(a,b){a.taxonomy="ccn";a.index=b+1;return a}))};f.parent=c});return c})))},f.parent=a)}},GAR:{action:function(){f.modification||k.ressources().then(function(b){f.tree={configurable:!1,filter:e,aside_template:"app/views/aside_RN.html?v\x3d"+l,tiles:g.pad_tiles_tree([c].concat(b.map(function(a,b){a.taxonomy="rn";a.index=b+1;a.icon=q+"/app/node_modules/laclasse-common-client/images/"+("MANUEL"===a.type?"05_validationcompetences.svg":"AUTRE"===a.type?"07_blogs.svg":
"08_ressources.svg");a.color=h[b%16].color;a.action=function(){g.log_and_open_link("GAR",a.url)};return a})))};f.parent=a})}},TROMBI:{action:function(){f.modification||(f.filter_criteria={show_classes:!0,show_groupes_eleves:!0,show_groupes_libres:!0,text:""},f.get_structure=function(a){return u.get_structure(a).then(function(a){return a.data})},k.groups().then(function(e){f.tree={configurable:!1,filter:function(){return function(a){return"back"===a.taxonomy||("regroupement"!==a.taxonomy||_(f.filter_criteria).has("show_classes")&&
f.filter_criteria.show_classes&&"CLS"===a.type||_(f.filter_criteria).has("show_groupes_eleves")&&f.filter_criteria.show_groupes_eleves&&"GRP"===a.type||_(f.filter_criteria).has("show_groupes_libres")&&f.filter_criteria.show_groupes_libres&&"GPL"===a.type)&&(!_(a).has("name")||_(f.filter_criteria.text).isEmpty()||a.name.toUpperCase().includes(f.filter_criteria.text.toUpperCase())||!_(a).has("structure")||_(f.filter_criteria.text).isEmpty()||a.structure.name.toUpperCase().includes(f.filter_criteria.text.toUpperCase()))}},
aside_template:"app/views/aside_TROMBI_regroupements.html?v\x3d"+l,tiles:g.pad_tiles_tree([c].concat(e.map(function(c,e){c.taxonomy="regroupement";c.index=e+1;switch(c.type){case "CLS":c.color="vert";break;case "GRP":c.color="bleu";break;default:c.color="jaune"}c.color+=0===e%2?"":"-moins";c.action=function(){f.filter_criteria.text="";u.get_users(_(c.users).pluck("user_id")).then(function(c){f.tree={configurable:!1,filter:function(){return function(a){return"eleve"!==a.taxonomy||_(f.filter_criteria.text).isEmpty()||
a.lastname.toUpperCase().includes(f.filter_criteria.text.toUpperCase())||a.firstname.toUpperCase().includes(f.filter_criteria.text.toUpperCase())}},aside_template:"app/views/aside_TROMBI_people.html?v\x3d"+l,tiles:g.pad_tiles_tree([b(a)].concat(c.data.map(function(a,b){a.taxonomy="eleve";a.index=b+1;a.color="jaune";a.color+=0===b%2?"":"-moins";a.avatar=(_(a.avatar.match(/^(user|http)/)).isNull()?v+"/":"")+a.avatar;return a})))};f.parent=a})};return c})))};f.parent=a}))}}};a.configure=!1;a.toggle_configure=
function(){console.log("before");console.log(a.configure);t();console.log("after");console.log(a.configure);a.configure?(console.log("setting .configure to false"),a.configure=!1):(f.tree.tiles.forEach(function(b){b.configure=b===a?!b.configure:!1}),console.log("setting .configure to true"),a.configure=!0);console.log("after bis");console.log(a.configure)};a.update=function(){n.update(a)};a.remove=function(){n.delete(a).$promise.then(function(a){r()})};!_(p[a.application_id]).isUndefined()&&_(p[a.application_id]).has("action")?
a.action=p[a.application_id].action:a.action=function(){f.modification||("EXTERNAL"===a.type||_(a.application_id).isNull()||"PRONOTE"===a.application_id?g.log_and_open_link("PRONOTE"===a.application_id?"PRONOTE":"EXTERNAL",a.url):d.go("app",{appid:a.application_id}))};!_(p[a.application_id]).isUndefined()&&_(p[a.application_id]).has("modify")&&(a=p[a.application_id].modify(a));return a},r=function(){k.tiles().then(function(a){a.forEach(function(a){a.taxonomy="app"});a=_(a).select(function(a){return(7!=
moment().month()||a.summer||!_(f.user.profiles).isEmpty()&&!_(["ELV","TUT"]).includes(f.user.active_profile().type))&&(!f.user.profiles||!f.user.active_profile()||f.user.is_admin()||!_(a.hidden).includes(f.user.active_profile().type))&&("MAIL"===a.application_id?_.chain(f.user.emails).pluck("type").includes("Ent").value():!0)}).map(x);a=g.fill_empty_tiles(a);a=_(a).sortBy(function(a){return a.index});a=g.pad_tiles_tree(a);f.tiles={configurable:!0,aside_template:"app/views/aside_news.html?v\x3d"+l,
tiles:a};c.action()})};f.modification=!1;f.edit_tiles=function(){f.modification=!0};f.exit_tiles_edition=function(){f.modification=!1;t().then(function(a){r()})};f.sortable_options={accept:function(a,b){return!0},longTouch:!0,dragEnd:function(a){_(f.tree.tiles).map(function(a,b){_(a).has("id")&&(a.index=b,a.update())})},containment:".damier",containerPositioning:"relative",additionalPlaceholderClass:"col-xs-6 col-sm-4 col-md-3 col-lg-3 petite case",clone:!1,allowDuplicates:!1};f.add_tile=function(a){w.add_tiles(a,
function(b){var c=_.chain(a).reject(function(a){return _(a).has("taxonomy")}).pluck("index").sort().value();_(b).each(function(b){b.structure_id=f.user.active_profile().structure_id;if(1>c.length){var e=a.length;a.push({index:e})}else e=c.shift();b.index=e;n.save({},b).$promise.then(function(a){r()})})},function(){})};r()})}}],template:'\n\x3cdiv class\x3d"row portail"\n                                                           ng:if\x3d"$ctrl.user"\x3e\n                                                        \x3cdiv class\x3d"col-xs-12 col-sm-12 col-md-4 col-lg-4 aside"\x3e\n                                                          \x3chelp-icon class\x3d"btn-group hidden-xs help-icon"\n                                                                     user\x3d"$ctrl.user"\x3e\x3c/help-icon\x3e\n\n                                                          \x3clogo class\x3d"col-xs-1 col-sm-1 col-md-6 col-lg-6 logolaclasse gris4"\n                                                                user\x3d"$ctrl.user"\x3e\x3c/logo\x3e\n\n                                                          \x3cuser-tile user\x3d"$ctrl.user"\x3e\x3c/user-tile\x3e\n\n                                                          \x3cdiv class\x3d"col-xs-12 col-sm-12 col-md-12 col-lg-12 hidden-xs hidden-sm aside-bottom"\n                                                               ng:include\x3d"$ctrl.user.edit_profile ? \'app/views/aside_news.html?v\x3d\' + $ctrl.CACHE_BUSTER : $ctrl.tree.aside_template"\x3e\x3c/div\x3e\n                                                        \x3c/div\x3e\n\n                                                        \x3cdiv class\x3d"col-xs-12 col-sm-12 col-md-8 col-lg-8"\x3e\n                                                          \x3cdiv class\x3d"row user-profil"\n                                                               ng:if\x3d"$ctrl.user.edit_profile"\x3e\n                                                            \x3cuser-profile user\x3d"$ctrl.user"\x3e\x3c/user-profile\x3e\n                                                          \x3c/div\x3e\n\n                                                          \x3cdiv class\x3d"row damier gris4"\n                                                               ng:class\x3d"{\'modification\': $ctrl.modification}"\n                                                               ng:if\x3d"!$ctrl.user.edit_profile"\x3e\n\n                                                            \x3cul data-as-sortable\x3d"$ctrl.sortable_options"\n                                                                data-is-disabled\x3d"!$ctrl.modification"\n                                                                ng:model\x3d"$ctrl.tree.tiles"\x3e\n\n                                                              \x3cli ng:repeat\x3d"tile in $ctrl.tree.tiles | filter:$ctrl.tree.filter()"\n                                                                  class\x3d"col-xs-6 col-sm-4 col-md-3 col-lg-3 petite case animate scale-fade-in {{tile.color}}"\n                                                                  data-as-sortable-item\n                                                                  ng:class\x3d"{ \'empty hidden-xs\': !tile.taxonomy }"\x3e\n                                                                \x3cdiv ng:include\x3d"$ctrl.get_tile_template( tile.taxonomy )"\x3e\x3c/div\x3e\n                                                              \x3c/li\x3e\n                                                            \x3c/ul\x3e\n\n                                                            \x3c!-- Mode normal --\x3e\n                                                            \x3cspan class\x3d"hidden-xs hidden-sm floating-button toggle big off blanc"\n                                                                  ng:if\x3d"$ctrl.tree.configurable \x26\x26 $ctrl.user.is_admin() \x26\x26 !$ctrl.modification"\n                                                                  ng:click\x3d"$ctrl.edit_tiles()"\x3e\x3c/span\x3e\n\n                                                            \x3c!-- Mode modification --\x3e\n                                                            \x3cspan class\x3d"hidden-xs hidden-sm floating-button toggle big on gris4"\n                                                                  ng:if\x3d"$ctrl.modification"\n                                                                  ng:click\x3d"$ctrl.exit_tiles_edition()"\x3e\x3c/span\x3e\n\n                                                            \x3cspan class\x3d"floating-button small action1 add-app gris1"\n                                                                  ng:if\x3d"$ctrl.modification"\n                                                                  ng:click\x3d"$ctrl.add_tile( $ctrl.tree.tiles )"\x3e\x3c/span\x3e\n                                                          \x3c/div\x3e\n\n                                                        \x3c/div\x3e\n                                                      \x3c/div\x3e\n'});
angular.module("portailApp").component("profilactif",{bindings:{user:"\x3c"},controller:["Annuaire","$state","$stateParams","currentUser",function(a,d,c,b){var h=this;h.apply_change=function(){b.activate_profile(h.current_profile.id).then(function(){d.transitionTo(d.current,c,{reload:!0,inherit:!0,notify:!0})})};h.$onInit=function(){h.user.profiles.forEach(function(b){a.get_structure(b.structure_id).then(function(a){b.structure=a.data});a.get_profile_type(b.type).then(function(a){b.profile=a.data})});
h.current_profile=h.user.active_profile()}}],template:'\n\x3cselect ng:disabled\x3d"$ctrl.user.profiles.length \x3c\x3d 1"\n        ng:model\x3d"$ctrl.current_profile"\n        ng:change\x3d"$ctrl.apply_change()"\n        ng:options\x3d"profile as profile.structure.name + \' : \' + profile.profile.name group by profile.structure.name for profile in $ctrl.user.profiles track by profile.id" \x3e\n\x3c/select\x3e\n'});
angular.module("portailApp").component("userProfile",{bindings:{user:"\x3d"},controller:["toastr","currentUser","APP_PATH","Utils","User",function(a,d,c,b,h){var e=this;e.dirty={};e.min_password_strength=1;e.prefix=c;e.groups=[{ouvert:!0,enabled:!0},{ouvert:!0,enabled:!0}];e.password={new1:"",new2:""};e.open_datepicker=function(a){a.preventDefault();a.stopPropagation()};e.mark_as_dirty=function(a){e.dirty[a]=!0};e.filter_emails=function(){return function(a){return("TUT"!==e.user.active_profile().type||
"Ent"!==a.type)&&_(a.asdress.match(a.user_id)).isNull()}};e.save=function(){if(!_(e.dirty).isEmpty()){var b={},c=!1;_(e.dirty).keys().forEach(function(a){b[a]=e.user[a]});e.dirty.password&&!_(e.password.new1).isEmpty()&&e.password.new1===e.password.new2&&e.passwordStrength.score>e.min_password_strength?b.password=e.password.new1:(delete b.password,c=e.dirty.password&&(e.password.new1!=e.password.new2||e.passwordStrength.score<=e.min_password_strength));c?e.password.new1!=e.password.new2?alert("Confirmation de mot de passe incorrecte."):
e.passwordStrength.score<=e.min_password_strength&&alert("Mot de passe trop faible."):_(b).isEmpty()||h.update({id:e.user.id},b).$promise.then(function(b){a.success("Mise \u00e0 jour effectu\u00e9e.")},function(a){})}};e.$onInit=function(){e.user.editable=_(e.user.aaf_jointure_id).isNull();e.user.birthdate=new Date(e.user.birthdate)}}],template:'\n                                                        \x3cheader\x3e\n                                                          \x3ch3\x3eProfil utilisateur\x3c/h3\x3e\n                                                          \x3ch1\x3e{{$ctrl.user.firstname}} {{$ctrl.user.lastname}}\x3c/h1\x3e\n                                                        \x3c/header\x3e\n                                                        \x3cdiv class\x3d"form"\x3e\n                                                          \x3cform\x3e\n                                                            \x3cdiv class\x3d"avatar-container form-group col-md-4 col-xs-12 pull-right"\x3e\n                                                              \x3clabel\x3eAvatar :\x3c/label\x3e\n                                                              \x3cavatar\x3e\x3c/avatar\x3e\n                                                            \x3c/div\x3e\n\n                                                            \x3caccordion close-others\x3d"false" class\x3d"col-md-8 col-xs-12 pull-left"\x3e\n\n                                                              \x3caccordion-group data-is-open\x3d"$ctrl.groups[ 0 ].ouvert" ng:if\x3d"$ctrl.groups[ 0 ].enabled"\x3e\n                                                                \x3caccordion-heading\x3e\n                                                                  \x3cspan class\x3d"glyphicon" ng:class\x3d"{\'glyphicon-chevron-down\': $ctrl.groups[ 0 ].ouvert, \'glyphicon-chevron-right\': !$ctrl.groups[ 0 ].ouvert}"\x3e\x3c/span\x3e Informations\n                                                                \x3c/accordion-heading\x3e\n                                                                \x3cdiv class\x3d"row"\x3e\n\n                                                                  \x3cdiv class\x3d"form-group col-md-6 col-xs-12"\x3e\n                                                                    \x3clabel for\x3d"nom"\x3eNom :\x3c/label\x3e\n                                                                    \x3cinput type\x3d"text"\n                                                                           id\x3d"nom"\n                                                                           class\x3d"form-control"\n                                                                           ng:disabled\x3d"!$ctrl.user.editable"\n                                                                           ng:change\x3d"$ctrl.mark_as_dirty( \'lastname\' )"\n                                                                           ng:model\x3d"$ctrl.user.lastname"\x3e\n                                                                  \x3c/div\x3e\n                                                                  \x3cdiv class\x3d"form-group col-md-6 col-xs-12"\x3e\n                                                                    \x3clabel for\x3d"prenom"\x3ePr\u00e9nom :\x3c/label\x3e\n                                                                    \x3cinput type\x3d"text"\n                                                                           id\x3d"prenom"\n                                                                           class\x3d"form-control"\n                                                                           ng:disabled\x3d"!$ctrl.user.editable"\n                                                                           ng:change\x3d"$ctrl.mark_as_dirty( \'firstname\' )"\n                                                                           ng:model\x3d"$ctrl.user.firstname"\x3e\n                                                                  \x3c/div\x3e\n                                                                  \x3cdiv class\x3d"form-group col-md-6 col-xs-12"\x3e\n                                                                    \x3clabel for\x3d"datenaissance"\x3eDate de naissance :\x3c/label\x3e\n                                                                    \x3cinput type\x3d"text"\n                                                                           id\x3d"date_naissance"\n                                                                           class\x3d"form-control"\n                                                                           disabled\n                                                                           value\x3d"{{$ctrl.user.birthdate | amDateFormat: \'LL\'}}"\n                                                                           ng:if\x3d"!$ctrl.user.editable" /\x3e\n                                                                    \x3cdiv uib-dropdown\n                                                                         id\x3d"datenaissance"\n                                                                         class\x3d"dropdown form-control date-naissance"\n                                                                         ng:if\x3d"$ctrl.user.editable"\x3e\n                                                                      \x3ca uib-dropdown-toggle\n                                                                         class\x3d"dropdown-toggle"\n                                                                         role\x3d"button"\n                                                                         data-toggle\x3d"uib-dropdown"\n                                                                         data-target\x3d"#"\n                                                                         href\x3e{{$ctrl.user.birthdate | amDateFormat: \'LL\'}}\x3c/a\x3e\n                                                                      \x3cdiv uib-dropdown-menu\n                                                                           class\x3d"dropdown-menu"\n                                                                           role\x3d"menu"\n                                                                           ng:click\x3d"$event.stopImmediatePropagation()"\x3e\n                                                                        \x3cdiv uib-datepicker\n                                                                             datepicker-options\x3d"datepicker_options"\n                                                                             ng:disabled\x3d"!$ctrl.user.editable"\n                                                                             ng:change\x3d"$ctrl.mark_as_dirty( \'birthdate\' )"\n                                                                             ng:model\x3d"$ctrl.user.birthdate"\n                                                                             ng:required\x3d"true"\x3e\n                                                                        \x3c/div\x3e\n                                                                      \x3c/div\x3e\n                                                                    \x3c/div\x3e\n                                                                  \x3c/div\x3e\n                                                                  \x3cdiv class\x3d"form-group col-md-6 col-xs-12"\x3e\n                                                                    \x3clabel for\x3d"adresse"\x3eAdresse :\x3c/label\x3e\n                                                                    \x3cinput type\x3d"text"\n                                                                           id\x3d"adresse"\n                                                                           class\x3d"form-control"\n                                                                           ng:disabled\x3d"!$ctrl.user.editable"\n                                                                           ng:change\x3d"$ctrl.mark_as_dirty( \'address\' )"\n                                                                           ng:model\x3d"$ctrl.user.address"\x3e\n                                                                  \x3c/div\x3e\n                                                                  \x3cdiv class\x3d"form-group col-md-6 col-xs-12"\x3e\n                                                                    \x3clabel for\x3d"codepostal"\x3eCode postal :\x3c/label\x3e\n                                                                    \x3cinput type\x3d"text"\n                                                                           id\x3d"codepostal"\n                                                                           class\x3d"form-control"\n                                                                           ng:disabled\x3d"!$ctrl.user.editable"\n                                                                           ng:change\x3d"$ctrl.mark_as_dirty( \'zip_code\' )"\n                                                                           ng:model\x3d"$ctrl.user.zip_code"\x3e\n                                                                  \x3c/div\x3e\n                                                                  \x3cdiv class\x3d"form-group col-md-6 col-xs-12"\x3e\n                                                                    \x3clabel for\x3d"ville"\x3eVille :\x3c/label\x3e\n                                                                    \x3cinput type\x3d"text"\n                                                                           id\x3d"ville"\n                                                                           class\x3d"form-control"\n                                                                           ng:disabled\x3d"!$ctrl.user.editable"\n                                                                           ng:change\x3d"$ctrl.mark_as_dirty( \'city\' )"\n                                                                           ng:model\x3d"$ctrl.user.city"\x3e\n                                                                  \x3c/div\x3e\n\n                                                                  \x3cdiv class\x3d"form-group col-md-6 col-xs-12"\n                                                                       ng:repeat\x3d"email in $ctrl.user.emails | orderBy:\'primary\':true | filter:filter_emails()"\x3e\n                                                                    \x3clabel for\x3d"courriel"\x3eCourriel \x3cspan ng:if\x3d"email.primary"\x3eprincipal\x3c/span\x3e :\x3c/label\x3e\n                                                                    \x3cinput type\x3d"text"\n                                                                           id\x3d"courriel"\n                                                                           class\x3d"form-control"\n                                                                           ng:disabled\x3d"true"\n                                                                           ng:model\x3d"email.address"\x3e\n                                                                  \x3c/div\x3e\n                                                                \x3c/div\x3e\n                                                                \x3cdiv class\x3d"row"\x3e\n                                                                  \x3cdiv class\x3d"form-group col-md-6 col-xs-12"\x3e\n                                                                    \x3clabel for\x3d"login"\x3eRappel de votre identifiant :\x3c/label\x3e\n                                                                    \x3cspan class\x3d"form-control" style\x3d"line-height: 34px; box-shadow: none;" disabled\x3e{{$ctrl.user.login}}\x3c/span\x3e\n                                                                  \x3c/div\x3e\n                                                                \x3c/div\x3e\n\n                                                              \x3c/accordion-group\x3e\n\n                                                              \x3caccordion-group data-is-open\x3d"$ctrl.groups[ 1 ].ouvert" ng:if\x3d"$ctrl.groups[ 1 ].enabled"\x3e\n                                                                \x3caccordion-heading\x3e\n                                                                  \x3cspan class\x3d"glyphicon" ng:class\x3d"{\'glyphicon-chevron-down\': $ctrl.groups[ 1 ].ouvert, \'glyphicon-chevron-right\': !$ctrl.groups[ 1 ].ouvert}"\x3e\x3c/span\x3e Mot de passe\x3cspan style\x3d"font-weight: bold; color: rgba(235,84,84,0.75)" ng:if\x3d"$ctrl.user.default_password"\x3e, pensez \u00e0 le changer...\x3c/span\x3e\n                                                                \x3c/accordion-heading\x3e\n                                                                \x3cdiv class\x3d"row"\x3e\n                                                                  \x3cdiv class\x3d"form-group col-md-6 col-xs-12"\x3e\n                                                                    \x3clabel for\x3d"newpasswd1"\x3eNouveau mot de passe :\x3c/label\x3e\n                                                                    \x3cinput type\x3d"password" class\x3d"form-control" id\x3d"newpasswd1"\n                                                                           ng:change\x3d"$ctrl.mark_as_dirty( \'password\' )"\n                                                                           ng:model\x3d"$ctrl.password.new1"\n                                                                           zxcvbn\x3d"$ctrl.passwordStrength"\n                                                                           zx-min-score\x3d"$ctrl.min_password_strength"\x3e\n                                                                    \x3cdiv class\x3d"password-strength"\n                                                                         ng:if\x3d"$ctrl.dirty.password \x26\x26 $ctrl.password.new1 !\x3d\x3d \'\'"\x3e\n                                                                      \x3clabel\x3eQualit\u00e9 du mot de passe :\x3c/label\x3e\n                                                                      \x3cuib-progressbar style\x3d"margin-bottom: 0;" max\x3d"5" value\x3d"$ctrl.passwordStrength.score + 1"\n                                                                                       type\x3d"{{ ( $ctrl.passwordStrength.score \x3c 2 ) ? \'danger\' : ( ( $ctrl.passwordStrength.score \x3c 3 ) ? \'warning\' : ( ( $ctrl.passwordStrength.score \x3c 4 ) ? \'primary\' : \'success\' ) ) }}"\x3e\n                                                                        \x3cspan ng:switch\x3d"$ctrl.passwordStrength.score"\x3e\n                                                                          \x3cspan style\x3d"color:white; white-space:nowrap;" ng:switch-when\x3d"0"\x3eTrop faible\x3c/span\x3e\n                                                                          \x3cspan style\x3d"color:white; white-space:nowrap;" ng:switch-when\x3d"1"\x3eFaible\x3c/span\x3e\n                                                                          \x3cspan style\x3d"color:white; white-space:nowrap;" ng:switch-when\x3d"2"\x3eMoyen\x3c/span\x3e\n                                                                          \x3cspan style\x3d"color:white; white-space:nowrap;" ng:switch-when\x3d"3"\x3eBon\x3c/span\x3e\n                                                                          \x3cspan style\x3d"color:white; white-space:nowrap;" ng:switch-when\x3d"4"\x3eExcellent\x3c/span\x3e\n                                                                        \x3c/span\x3e\n                                                                      \x3c/uib-progressbar\x3e\n                                                                      \x3cuib-progressbar max\x3d"5" value\x3d"$ctrl.min_password_strength + 1"\n                                                                                       type\x3d"primary"\x3e\n                                                                        \x3cspan style\x3d"color:white; white-space:nowrap;"\x3eMinimum acc\u00e9pt\u00e9\x3c/span\x3e\n                                                                      \x3c/uib-progressbar\x3e\n                                                                    \x3c/div\x3e\n                                                                  \x3c/div\x3e\n                                                                  \x3cdiv class\x3d"form-group col-md-6 col-xs-12"\n                                                                       ng:class\x3d"{\'has-error\': $ctrl.password.new1 !\x3d\x3d $ctrl.password.new2 }"\x3e\n                                                                    \x3clabel for\x3d"newpasswd2"\x3eConfirmer le nouveau mot de passe :\x3c/label\x3e\n                                                                    \x3cinput type\x3d"password" class\x3d"form-control" id\x3d"newpasswd2"\n                                                                           ng:model\x3d"$ctrl.password.new2"\x3e\n                                                                  \x3c/div\x3e\n                                                                \x3c/div\x3e\n                                                              \x3c/accordion-group\x3e\n\n                                                              \x3cfooter\x3e\n                                                                \x3cbutton ng:click\x3d"$ctrl.save()"\x3eEnregistrer\x3c/button\x3e\n                                                              \x3c/footer\x3e\n                                                            \x3c/accordion\x3e\n                                                          \x3c/form\x3e\n                                                        \x3c/div\x3e\n'});
angular.module("portailApp").component("userTile",{bindings:{user:"\x3c"},controller:["APP_PATH","URL_ENT",function(a,d){var c=this;c.APP_PATH=a;c.change_password_message="Pensez \u00e0 changer votre mot de passe...";c.edit_profile=function(){c.user.edit_profile=!c.user.edit_profile};c.$onInit=function(){c.url_avatar=d+"/"+c.user.avatar}}],template:'\n\x3cdiv class\x3d"col-xs-11 col-sm-11 col-md-6 col-lg-6 user"\n     ng:style\x3d"{ \'background-image\': \'url(\' + $ctrl.url_avatar + \')\' }"\x3e\n    \x3cdiv class\x3d"user-info-bg"\x3e\n        \x3cspan class\x3d"user-info"\x3e\n            \x3ca href style\x3d"text-decoration: none;" ng:click\x3d"$ctrl.edit_profile()"\x3e\n                \x3ch4 class\x3d"hidden-xs hidden-sm full-name"\x3e{{$ctrl.user.firstname}} {{$ctrl.user.lastname}}\n                    \x3csup ng:if\x3d"$ctrl.user.default_password"\x3e\x3cspan class\x3d"glyphicon glyphicon-alert default-password" aria-hidden\x3d"true" data-descr\x3d"{{$ctrl.change_password_message}}"\x3e\x3c/span\x3e\x3c/sup\x3e\n                \x3c/h4\x3e\n                \x3ch4 class\x3d"hidden-md hidden-lg initiales"\x3e{{$ctrl.user.firstname[0]}}{{$ctrl.user.lastname[0]}}\x3c/h4\x3e\n            \x3c/a\x3e\n            \x3cprofilactif class\x3d"gris4"\n                         ng:if\x3d"$ctrl.user.profiles"\n                         user\x3d"$ctrl.user"\x3e\x3c/profilactif\x3e\n            \x3ca class\x3d"btn hidden-xs hidden-sm logout" ng:href\x3d"/sso/logout" title\x3d"D\u00e9connexion de Laclasse.com"\x3ese d\u00e9connecter\x3c/a\x3e\n        \x3c/span\x3e\n    \x3c/div\x3e\n\x3c/div\x3e\n'});
angular.module("portailApp").factory("Flux",["$resource","URL_ENT",function(a,d){return a(d+"/api/flux/:id",{id:"@id",structure_id:"@structure_id",url:"@url",name:"@name"},{get:{isArray:!0},update:{method:"PUT"}})}]);
angular.module("portailApp").factory("RessourceNumerique",["$resource","URL_ENT",function(a,d){return a(d+"api/structures/:id/ressources/:ressource_id",{id:"@id",ressource_id:"@ressource_id",ressource_num_id:"@ressource_num_id",date_deb_abon:"@date_deb_abon",date_fin_abon:"@date_fin_abon"},{query_default:{methode:"GET",url:d+"api/ressources/",isArray:!0}})}]);
angular.module("portailApp").factory("Tiles",["$resource","URL_ENT","CONFIG",function(a,d,c){return a(d+"/api/tiles/:id",{id:"@id",structure_id:"@structure_id",application_id:"@application_id",index:"@index",type:"@type",name:"@name",description:"@description",url:"@url",icon:"@icon",color:"@color"},{update:{method:"PUT"},query:{method:"GET",cache:!1,isArray:!0,transformResponse:function(a,d){return _(angular.fromJson(a)).map(function(a){return _(c.apps.default[a.application_id]).isUndefined()?a:
_(c.apps.default[a.application_id]).extend(a)})}}})}]);
angular.module("portailApp").factory("User",["$resource","URL_ENT",function(a,d){a=a(d+"/api/users/:id",{id:"@id",firstname:"@firstname",lastname:"@lastname",gender:"@gender",birthdate:"@birthdate",address:"@address",zip_code:"@zip_code",city:"@city",password:"@password"},{get:{cache:!1},update:{method:"PUT"},upload_avatar:{method:"POST",url:d+"/api/users/:id/upload/avatar",transformRequest:function(a){var b=new FormData;b.append("image",a.new_avatar.blob,"new_avatar.png");b.append("fileFormDataName",
"image");delete a.new_avatar;return b},headers:{"Content-Type":void 0}}});a.prototype.active_profile=function(){return _(this.profiles).findWhere({active:!0})};a.prototype.is_admin=function(){return _(this).has("super_admin")&&this.super_admin||!_(this.profiles).isEmpty()&&(!_.chain(this.profiles).findWhere({structure_id:this.active_profile().structure_id,type:"DIR"}).isUndefined().value()||!_.chain(this.profiles).findWhere({structure_id:this.active_profile().structure_id,type:"ADM"}).isUndefined().value())};
return a}]);
angular.module("portailApp").service("CCN",["Utils","currentUser",function(a,d){this.query=function(){var c=[{nom:"14-18",description:"14-18",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_14-18.svg",color:"jaune",action:function(){a.log_and_open_link("CCN","http://14-18.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{nom:"Z\u00e9rogaspi",description:"Z\u00e9rogaspi",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_zero-gaspi.svg",color:"bleu",
action:function(){a.log_and_open_link("CCN","http://zerogaspi.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{nom:"AIR",description:"Assises du Roman",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_air-2014.svg",color:"jaune",action:function(){a.log_and_open_link("CCN","http://air.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{nom:"Habiter",description:"Repr\u00e9sentations cartographiques de l'espace v\u00e9cu",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_habiter.svg",
color:"vert",action:function(){a.log_and_open_link("CCN","http://habiter.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{nom:"Code",description:"Mener un projet de code cr\u00e9atif avec sa classe et r\u00e9aliser un jeu en r\u00e9seau",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_code.svg",color:"orange-brillant",action:function(){a.log_and_open_link("CCN","http://code.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{nom:"Polar / Krimi",
description:"Ecrire un roman illustr\u00e9 franco-allemand avec un auteur de polar et un illustrateur, en collaboration avec des coll\u00e9giens allemands",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_krimi.svg",color:"bleu-fonce",action:function(){a.log_and_open_link("CCN","http://krimi.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{nom:"Projets archiv\u00e9s",description:"Projets archiv\u00e9s",icon:"/app/node_modules/laclasse-common-client/images/06_thematiques.svg",
color:"gris1",leaves:[{nom:"Th\u00e9\u00e2tre",description:"Th\u00e9\u00e2tre",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_theatre.svg",color:"rouge",action:function(){a.log_and_open_link("CCN","http://theatre.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{nom:"Philo",description:"Philo",action:function(){a.log_and_open_link("CCN","http://philo.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")},icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_philo.svg",
color:"violet"},{color:"gris2",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_miam.svg",nom:"Miam",titre:"",action:function(){a.log_and_open_link("CCN","http://miam.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{color:"bleu",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_odysseespatiale.svg",nom:"Odyss\u00e9e spatiale",titre:"",action:function(){a.log_and_open_link("CCN","http://novaterra.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},
{color:"jaune",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_archeologie.svg",nom:"Arch\u00e9ologie",titre:"",action:function(){a.log_and_open_link("CCN","http://archeologies.laclasse.com/")}},{color:"orange",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_bd.svg",nom:"BD",titre:"",action:function(){a.log_and_open_link("CCN","http://bd.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{color:"violet",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_cine.svg",
nom:"Cin\u00e9",titre:"",action:function(){a.log_and_open_link("CCN","http://cine.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{color:"vert",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_cluemo.svg",nom:"Clu\u00e9mo",titre:"",action:function(){a.log_and_open_link("CCN","http://cluemo.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{color:"rouge",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_etudiantsvoyageurs.svg",
nom:"Etudiants voyageurs",titre:"",action:function(){a.log_and_open_link("CCN","http://etudiantsvoyageurs.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{color:"vert",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_finisterrae.svg",nom:"Finisterrae",titre:"",action:function(){a.log_and_open_link("CCN","http://finisterrae.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{color:"gris4",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_dechetmatiere.svg",
nom:"Le d\u00e9chet mati\u00e8re",titre:"",action:function(){a.log_and_open_link("CCN","http://ledechetmatiere.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{color:"violet",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_maisondeladanse.svg",nom:"Maison de la danse",titre:"",action:function(){a.log_and_open_link("CCN","http://maisondeladanse.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{color:"bleu",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_musique.svg",
nom:"Musique",titre:"",action:function(){a.log_and_open_link("CCN","http://musique.laclasse.com/")}},{color:"jaune",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_science.svg",nom:"Science",titre:"",action:function(){a.log_and_open_link("CCN","http://science.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}},{color:"orange",icon:"/app/node_modules/laclasse-common-client/images/thematiques/icon_picture.svg",nom:"Picture",titre:"",action:function(){a.log_and_open_link("CCN",
"http://picture.laclasse.com/?url\x3dspip.php%3Fpage%3Dsommaire\x26cicas\x3doui")}}]}];d.get(!1).then(function(b){["DIR","ENS","DOC"].includes(b.active_profile().type)&&c.push({nom:"Projets 2017-2018",description:"",icon:"/app/node_modules/laclasse-common-client/images/06_thematiques.svg",color:"bleu-plus",action:function(){a.log_and_open_link("inscription_CCN","https://www.laclasse.com/portail/inscription_CCN/index.html")}})});return c}}]);
angular.module("portailApp").service("Annuaire",["$http","URL_ENT","CONFIG",function(a,d,c){this.get_structure=_.memoize(function(b){return a.get(d+"/api/structures/"+b,{params:{expand:!1}})});this.get_structures=_.memoize(function(b){return a.get(d+"/api/structures/",{params:{"id[]":b,expand:!1}})});this.get_structure_tiles=_.memoize(function(b){return a.get(d+"/api/tiles/",{params:{structure_id:b}})});this.query_applications=_.memoize(function(b){return a.get(d+"/api/applications/").then(function(a){return _.chain(a.data).reject(function(a){return _(["ANNUAIRE",
"ANN_ENT","PORTAIL","SSO","STARTBOX"]).includes(a.id)}).map(function(a){return _(c.apps.default[a.id])?(a.type="INTERNAL",a.application_id=a.id,delete a.id,_(a).extend(c.apps.default[a.application_id])):null}).compact().value()})});this.get_profile_type=_.memoize(function(b){return a.get(d+"/api/profiles_types/"+b)});this.get_structure_resources=function(b){return a.get(d+"/api/resources/",{params:{"structures.structure_id":b}})};this.get_resource=function(b){return a.get(d+"/api/resources/"+b)};
this.get_users=_.memoize(function(b){return a.get(d+"/api/users/",{params:{"id[]":b}})})}]);
angular.module("portailApp").service("currentUser",["$http","$resource","$q","URL_ENT","User","Tiles","Annuaire",function(a,d,c,b,h,e,k){var g=this,m=void 0;g.get=function(c){if(_(m).isUndefined()||c)m=a.get(b+"/api/users/current").then(function(a){return new h(a.data)});return m};g.activate_profile=function(c){return g.get(!1).then(function(d){return a({method:"PUT",url:b+"/api/users/"+d.id+"/profiles/"+c,data:{active:!0}})})};g.ressources=function(){return g.get(!1).then(function(a){return k.get_structure_resources(a.active_profile().structure_id).then(function(a){return a.data})})};
g.tiles=function(){return g.get(!1).then(function(a){return _(a.profiles).isEmpty()?k.query_applications().then(function(a){a=_.chain(a).select(function(a){return _(["MAIL","DOC"]).includes(a.application_id)}).map(function(a){a.summer=!0;return a}).value();return c.resolve(a)}):e.query({structure_id:a.active_profile().structure_id}).$promise})};g.groups=function(){return g.get(!1).then(function(d){var e=_.chain(d.profiles).pluck("structure_id").uniq().value(),h=k.get_structures(e),g=_(d.groups).pluck("group_id");
g=_(g).isEmpty()?c.resolve([]):a.get(b+"/api/groups/",{params:{"id[]":g}}).then(function(a){return a.data});var m=c.resolve([]);0<_.chain(d.profiles).pluck("type").intersection(["DIR","ADM","CPE"]).value().length&&(m=a.get(b+"/api/groups/",{params:{"structure_id[]":e}}).then(function(a){return a.data}));return c.all([g,m,h]).then(function(a){var b=a.pop().data;return _.chain(a).flatten().uniq("id").map(function(a){a.structure=_(b).findWhere({id:a.structure_id});return a}).value()})})};g.recent_mail=
function(){return g.get(!1).then(function(c){return a.get(b+"/api/users/"+c.id+"/imapcheck")})}}]);
angular.module("portailApp").service("log",["$http","$state","URL_ENT","APP_PATH","currentUser",function(a,d,c,b,h){this.add=function(e,k,g){h.get(!1).then(function(h){a.post(c+"/api/logs",{application_id:e,user_id:h.id,structure_id:h.active_profile()?h.active_profile().structure_id:"none",profil_id:h.active_profile()?h.active_profile().type:"none",url:_(k).isNull()?b+d.current.url:k,parameters:_(g).isNull()?_(d.params).map(function(a,b){return b+"\x3d"+a}).join("\x26"):g})})}}]);
angular.module("portailApp").service("Popups",["$uibModal",function(a){this.add_tiles=function(d,c,b){a.open({controller:["$scope","$uibModalInstance","APP_PATH","Tiles","currentUser","Annuaire","current_tiles",function(a,b,c,d,m,n,q){a.prefix=c;a.available_tiles=[];a.tiles_selected=!1;a.add_empty_link_tile=function(){a.available_tiles.push(new d({creation:!0,present:!1,type:"EXTERNAL",name:"",description:"",url:"http://",color:"",selected:!0,taxonomy:"app"}))};a.keep_tile_selected=function(b,c){c.selected=
!1;a.selected(c);b.stopImmediatePropagation()};a.selected=function(b){b.selected=!b.selected;a.tiles_selected=0<_(a.available_tiles).select({selected:!0}).length};a.ok=function(){b.close(_(a.available_tiles).select({selected:!0}))};a.cancel=function(){b.dismiss()};n.query_applications().then(function(b){a.available_tiles=a.available_tiles.concat(_.chain(b).uniq(function(a){return a.application_id}).each(function(a){a.taxonomy="app";a.available=function(){return!_.chain(q).reject(function(a){return a.to_delete}).pluck("application_id").contains(a.application_id).value()}}).value());
_(a.available_tiles).each(function(a){a.selected=!1})})}],resolve:{current_tiles:function(){return d}},template:'\n\x3cdiv class\x3d"modal-header"\x3e\n    \x3ch3 class\x3d"modal-title"\x3eAjouter une tuile\x3c/h3\x3e\n\x3c/div\x3e\n\x3cdiv class\x3d"modal-body available-apps"\x3e\n    \x3cul\x3e\n        \x3cli class\x3d"new-app"\n            ng:repeat\x3d"tile in available_tiles"\n            ng:if\x3d"tile.available() || tile.creation"\n            ng:class\x3d"{\'selected\': tile.selected, \'creation\': tile.creation, \'pronote\': tile.application_id \x3d\x3d \'PRONOTE\'}"\n            ng:click\x3d"selected( tile )"\x3e\n\n            \x3ca ng:if\x3d"!tile.creation"\n               title\x3d"{{ tile.description }}"\n               ng:style\x3d"{\'background-color\': tile.color }"\x3e\n                \x3cimg draggable\x3d"false" class\x3d"icone" ng:src\x3d"{{prefix}}/{{tile.icon}}"\n                     ng:if\x3d"tile.icon"/\x3e\n                \x3cspan class\x3d"app-name" ng:cloak\x3e{{ tile.name }}\x3c/span\x3e\n                \x3clabel ng:if\x3d"tile.application_id \x3d\x3d \'PRONOTE\'"\x3elien \x3cinput type\x3d"text" ng:model\x3d"tile.url" ng:click\x3d"keep_tile_selected( $event, tile )"/\x3e\x3c/label\x3e\n            \x3c/a\x3e\n\n            \x3cfieldset ng:if\x3d"tile.creation"\x3e\n                \x3clegend\x3elien libre\x3c/legend\x3e\n\n                \x3clabel\x3elibell\u00e9 \x3cinput type\x3d"text" ng:model\x3d"tile.name" ng:click\x3d"keep_tile_selected( $event, tile )" /\x3e\x3c/label\x3e\n                \x3clabel\x3elien \x3cinput type\x3d"text" ng:model\x3d"tile.url" ng:click\x3d"keep_tile_selected( $event, tile )" /\x3e\x3c/label\x3e\n            \x3c/fieldset\x3e\n        \x3c/li\x3e\n    \x3c/ul\x3e\n    \x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\n\x3c/div\x3e\n\x3cdiv class\x3d"modal-footer"\x3e\n    \x3cbutton class\x3d"btn btn-primary pull-left" ng:click\x3d"add_empty_link_tile()"\x3e\n        \x3cspan class\x3d"glyphicon glyphicon-plus-sign"\x3e\x3c/span\x3e Ajouter un lien libre\n    \x3c/button\x3e\n\n    \x3cbutton class\x3d"btn btn-default" ng:click\x3d"cancel()"\x3e\n        \x3cspan class\x3d"glyphicon glyphicon-remove-sign"\x3e\x3c/span\x3e \x3cspan ng:if\x3d"tiles_selected"\x3eAnnuler\x3c/span\x3e\x3cspan ng:if\x3d"!tiles_selected"\x3eFermer\x3c/span\x3e\n    \x3c/button\x3e\n    \x3cbutton class\x3d"btn btn-success"\n            ng:click\x3d"ok()"\n            ng:disabled\x3d"!tiles_selected"\x3e\n        \x3cspan class\x3d"glyphicon glyphicon-ok-sign"\x3e\x3c/span\x3e Valider\n    \x3c/button\x3e\n\x3c/div\x3e\n',
backdrop:"static"}).result.then(c,b)};this.manage_fluxes=function(d,c){a.open({template:'\n\x3cdiv class\x3d"modal-header"\x3e\n    \x3ch3 class\x3d"modal-title"\x3eG\u00e9rer les flux RSS affich\u00e9s sur le portail de l\'\u00e9tablissement\x3c/h3\x3e\n\x3c/div\x3e\n\x3cdiv class\x3d"modal-body config-fluxes"\x3e\n    \x3cul\x3e\n        \x3cli ng:repeat\x3d"flux in $ctrl.current_flux"\x3e\n            \x3clabel\x3etitre \x3cinput type\x3d"text"\n                                ng:model\x3d"flux.name"\n                                ng:change\x3d"$ctrl.dirtify( flux )" /\x3e\x3c/label\x3e\n            \x3clabel\x3eurl \x3cinput type\x3d"text"\n                              ng:model\x3d"flux.url"\n                              ng:change\x3d"$ctrl.dirtify( flux )" /\x3e\x3c/label\x3e\n\n            \x3cdiv class\x3d"controls"\x3e\n                \x3cbutton class\x3d"btn-default delete"\n                        ng:click\x3d"$ctrl.delete( flux )"\x3e\x3cspan class\x3d"glyphicon glyphicon-trash"\x3e\x3c/span\x3e\x3c/button\x3e\n                \x3cbutton class\x3d"btn-primary save"\n                        ng:if\x3d"flux.dirty"\n                        ng:click\x3d"$ctrl.save( flux )"\x3e\x3cspan class\x3d"glyphicon glyphicon-ok-sign"\x3e\x3c/span\x3e\x3c/button\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\n        \x3c/li\x3e\n    \x3c/ul\x3e\n    \x3cdiv class\x3d"clearfix"\x3e\x3c/div\x3e\n\n    \x3cbutton style\x3d"right: 4em;"\n            ng:click\x3d"$ctrl.add_default_flux()"\x3e\x3cspan class\x3d"glyphicon glyphicon-cloud-download"\x3e\x3c/span\x3e\x3c/button\x3e\n    \x3cbutton ng:click\x3d"$ctrl.add_flux()"\x3e\x3cspan class\x3d"glyphicon glyphicon-plus-sign"\x3e\x3c/span\x3e\x3c/button\x3e\n\x3c/div\x3e\n\x3cdiv class\x3d"modal-footer"\x3e\n    \x3cbutton class\x3d"btn btn-default" ng:click\x3d"$ctrl.close()"\x3e\n        \x3cspan class\x3d"glyphicon glyphicon-remove-sign"\x3e\x3c/span\x3e Fermer\n    \x3c/button\x3e\n\x3c/div\x3e\n',
controller:["$scope","$uibModalInstance","currentUser","Flux","CONFIG",function(a,c,d,k,g){a.$ctrl=a;a.nb_articles=_.range(1,11);a.current_flux=[];a.delete=function(b){b.$delete();a.current_flux=_(a.current_flux).difference([b])};a.save=function(b){b.structure_id=a.user.active_profile().structure_id;return _(b).has("id")?b.$update():b.$save()};a.dirtify=function(a){a.dirty=!0};a.add_flux=function(){a.current_flux.push(new k({name:"",url:"",icon:""}))};a.add_default_flux=function(){_(g.news_feed).each(function(b){a.dirtify(b);
a.current_flux.push(new k(b))})};a.close=function(){c.close()};a.$onInit=function(){d.get(!1).then(function(b){a.user=b;k.get({structure_id:a.user.active_profile().structure_id}).$promise.then(function(b){a.current_flux=_(b).map(function(a){a.dirty=!1;return a})})})};a.$onInit()}],backdrop:"static"}).result.then(d,c)}}]);
angular.module("portailApp").service("Utils",["$state","$window","CASES","log",function(a,d,c,b){this.pad_tiles_tree=function(a){return a.concat(_(c.slice(a.length,c.length)).map(function(b,c){return{index:c+a.length,color:b.color+"-moins"}}))};this.fill_empty_tiles=function(a){var b=a.map(function(a){return a.index});_.chain(b).max().range().difference(b).each(function(b){a.push({index:b,color:c[b%c.length].color+"-moins"})});return a};this.log_and_open_link=function(a,c){b.add(a,c,null);d.open(c)};
this.go_home=function(){a.go("portail",{},{reload:!0,inherit:!0,notify:!0})}}]);
